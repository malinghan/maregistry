//
// HealthChecker.java
// 健康检查器接口
//
// 该接口定义了服务实例健康检查的核心功能契约
// 负责定时检查服务实例的存活状态，自动摘除超时实例
//

package com.malinghan.maregistry.health;

/**
 * 健康检查器接口
 * 
 * 该接口定义了健康检查服务的核心功能，包括启动、停止和执行健康检查。
 * 基于心跳时间戳机制实现服务实例的存活检测。
 * 
 * 设计原则：
 * - 被动健康检查：依赖服务实例主动上报心跳
 * - 定时执行：周期性检查所有已注册实例的状态
 * - 自动摘除：超时未续约的实例自动从注册中心移除
 * - 生命周期管理：支持优雅启动和关闭
 */
public interface HealthChecker {
    
    /**
     * 启动健康检查任务
     * 
     * 初始化定时任务调度器，开始周期性执行健康检查。
     * 通常在应用启动时调用。
     * 
     * 实现要求：
     * - 使用ScheduledExecutorService而非Spring @Scheduled
     * - 设置合适的检查间隔（建议10秒）
     * - 确保线程安全和资源正确释放
     */
    void start();
    
    /**
     * 停止健康检查任务
     * 
     * 关闭定时任务调度器，清理相关资源。
     * 通常在应用关闭时调用。
     * 
     * 实现要求：
     * - 优雅关闭，等待正在执行的任务完成
     * - 释放线程池和其他系统资源
     * - 确保不会产生资源泄漏
     */
    void stop();
    
    /**
     * 执行健康检查
     * 
     * 检查所有已注册服务实例的心跳时间戳，摘除超时实例。
     * 这是健康检查的核心逻辑方法。
     * 
     * 检查逻辑：
     * 1. 遍历所有服务的时间戳记录
     * 2. 计算每个实例距离上次心跳的时间差
     * 3. 超过阈值（如20秒）的实例标记为不健康
     * 4. 调用注册服务的unregister方法摘除不健康实例
     * 
     * 性能考虑：
     * - 避免在检查过程中阻塞其他操作
     * - 合理控制检查频率，平衡及时性和系统开销
     */
    void check();
}